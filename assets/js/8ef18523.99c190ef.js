"use strict";(self.webpackChunk_yuants_docs=self.webpackChunk_yuants_docs||[]).push([[3541],{834:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>l,contentTitle:()=>r,default:()=>h,frontMatter:()=>o,metadata:()=>a,toc:()=>c});var s=i(9541),t=i(4317);const o={},r="Cross-Language Interoperability Guide",a={id:"vendor-guide/cross-language-interoperability",title:"Cross-Language Interoperability Guide",description:"If the provider SDK's language is not JavaScript or a common application layer protocol like HTTP, things can get quite complex.",source:"@site/docs/vendor-guide/cross-language-interoperability.md",sourceDirName:"vendor-guide",slug:"/vendor-guide/cross-language-interoperability",permalink:"/docs/vendor-guide/cross-language-interoperability",draft:!1,unlisted:!1,editUrl:"https://github.com/No-Trade-No-Life/Yuan/tree/main/ui/docs/docs/vendor-guide/cross-language-interoperability.md",tags:[],version:"current",frontMatter:{},sidebar:"docsSidebar",previous:{title:"What is a Vendor",permalink:"/docs/vendor-guide/what-is-vendor"},next:{title:"Providing Account Information",permalink:"/docs/vendor-guide/vendor-account-info"}},l={},c=[{value:"Architecture",id:"architecture",level:2},{value:"REPL Style",id:"repl-style",level:2},{value:"Infrastructure",id:"infrastructure",level:2},{value:"Communication Middleware ZMQ",id:"communication-middleware-zmq",level:3},{value:"Reactive Programming Paradigm Reactive JS (RxJS)",id:"reactive-programming-paradigm-reactive-js-rxjs",level:3},{value:"Some Miscellaneous Points",id:"some-miscellaneous-points",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.a)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.h1,{id:"cross-language-interoperability-guide",children:"Cross-Language Interoperability Guide"}),"\n",(0,s.jsxs)(n.admonition,{title:"You Might Not Need to Read This Guide",type:"info",children:[(0,s.jsx)(n.p,{children:"If the provider SDK's language is not JavaScript or a common application layer protocol like HTTP, things can get quite complex."}),(0,s.jsx)(n.p,{children:"If your scenario is not this complex, please skip this guide."})]}),"\n",(0,s.jsxs)(n.p,{children:["For the sake of illustration, let's assume the SDK's language is ",(0,s.jsx)(n.strong,{children:"X"}),"."]}),"\n",(0,s.jsx)(n.p,{children:"Before we begin, let's make some basic assumptions:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"The developer (that's you) has a basic but not in-depth understanding of the X language, aiming to minimize the development complexity of the X language part."}),"\n",(0,s.jsx)(n.li,{children:"Yuan has provided a series of JS libraries to help you quickly integrate with the X SDK and handle various chores."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"From these assumptions, we can draw some inferences:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"Direct communication with the host network using the X language is not considered."}),"\n",(0,s.jsx)(n.li,{children:"Packaging the X SDK into WASM to run in the JS Runtime is not considered."}),"\n",(0,s.jsx)(n.li,{children:"Direct cross-language calls to the X SDK from the JS side via memory binding are not considered."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"These assumptions are made to minimize the complexity of integration, improve efficiency and quality, and avoid unnecessary overhead."}),"\n",(0,s.jsxs)(n.p,{children:["Of course, you can modify the integration approach yourself, as long as you follow Yuan's ",(0,s.jsx)(n.a,{href:"/docs/protocol/introduce",children:"Technical Protocol"}),", you can integrate with Yuan like other providers."]}),"\n",(0,s.jsx)(n.h2,{id:"architecture",children:"Architecture"}),"\n",(0,s.jsx)(n.p,{children:'Based on these assumptions, we can derive a simple architecture consisting of two processes: the "JS side" and the "X side".'}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:"The JS side is heavier, responsible for communication with the host, asynchronous process scheduling, calling the X side, and various chores."}),"\n",(0,s.jsx)(n.li,{children:"The X side is lighter, responsible for calling the SDK and executing business logic."}),"\n",(0,s.jsx)(n.li,{children:"Both processes run in a single container."}),"\n"]}),"\n",(0,s.jsx)(n.h2,{id:"repl-style",children:"REPL Style"}),"\n",(0,s.jsx)(n.p,{children:"It is recommended to encapsulate the X side into a REPL (Read-Eval-Print Loop) style, which can greatly simplify the complexity of the X side. All programming languages, all computational statements can be categorized into: call (CALL), return (RETURN), throw exception (THROW), or callback (CALLBACK)."}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"The X side does not need to support loops and branch jump structures, nor does it need to save history."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Use JSON for input and output encoding:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-ts",children:"interface IMessage {\n  trace_id: string;\n  type: 'call' | 'return' | 'throw' | 'callback';\n  method?: string; // for call\n  params?: any[]; // for call and callback\n  value?: any; // for return\n  message?: string; // for throw\n}\n"})}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"The structure may be nested, it is recommended to use JSON for serialization."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Or use a simpler encoding:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Each message occupies a single line, if there are newline characters \\n within the message, they must be escaped as \\n."}),"\n",(0,s.jsx)(n.li,{children:"Start with the message ID, followed by a space; then the type of the message, which is one of CALL, RETURN, THROW, CALLBACK; the subsequent parts are freely agreed upon and can be any structure."}),"\n"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{children:"> ID CALL METHOD PARAM1 ... PARAM_N\n< ID RETURN VALUE\n< ID THROW ERROR\n< ID CALLBACK PARAM1 ... PARAM_N\n"})}),"\n",(0,s.jsx)(n.admonition,{title:"Why Use a Simpler Encoding?",type:"note",children:(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"The X side may not have a suitable JSON library; binding JSON may not be a good choice if structure transmission is not involved."}),"\n",(0,s.jsx)(n.li,{children:"PARAM, VALUE, ERROR can all be internally encoded as JSON without conflict."}),"\n",(0,s.jsx)(n.li,{children:"Any language can easily interpret and execute this simple encoding."}),"\n"]})}),"\n",(0,s.jsx)(n.admonition,{title:"Why Design as REPL Style?",type:"info",children:(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"The X side may have high costs for handling asynchronous or multithreaded operations."}),"\n",(0,s.jsx)(n.li,{children:"The X side may encounter performance bottlenecks or throttling from the SDK more quickly."}),"\n"]})}),"\n",(0,s.jsx)(n.p,{children:"The design requires the JS side to actively restart the X side process if it fails to respond in time, because:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"The X side may fail to respond to the JS side due to known or unknown reasons."}),"\n",(0,s.jsx)(n.li,{children:"When a program does not respond for a long time in REPL, humans will actively Ctrl-C to exit and retry. The JS side thinks the same way."}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{title:"Why Need CALLBACK Interface?",type:"note",children:(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"The X side may provide real-time subscription interfaces or asynchronous interfaces, so it needs to actively push to the JS side."}),"\n"]})}),"\n",(0,s.jsx)(n.h2,{id:"infrastructure",children:"Infrastructure"}),"\n",(0,s.jsx)(n.p,{children:"To meet the logical complexity of a specific business logic system, it cannot be completely eliminated, only absorbed through logical reuse. Yuan's maintained libraries will absorb some logic in the JS side, thereby reducing the logical complexity of the JS side, ultimately making the integration process easier."}),"\n",(0,s.jsx)(n.h3,{id:"communication-middleware-zmq",children:"Communication Middleware ZMQ"}),"\n",(0,s.jsx)(n.p,{children:"The JS side and the X side use ZeroMQ as the message middleware for communication."}),"\n",(0,s.jsx)(n.admonition,{title:"Why Use Message Middleware?",type:"info",children:(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"The X side may not provide a STDIO interface and must communicate between processes through other means."}),"\n"]})}),"\n",(0,s.jsx)(n.admonition,{title:"Why Not Use TCP Directly?",type:"info",children:(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsxs)(n.li,{children:["ZMQ supports TCP automatic reconnection, high-performance asynchronous IO, memory overflow limits, etc. It is recommended to read ",(0,s.jsx)(n.a,{href:"http://wiki.zeromq.org/topics:omq-is-just-sockets",children:"\xd8MQ is just Sockets! - zeromq"}),"."]}),"\n"]})}),"\n",(0,s.jsx)(n.admonition,{title:"Why Use ZMQ Instead of Other Frameworks?",type:"info",children:(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"ZMQ is simple, only doing transport protocols and message patterns, leaving the application layer protocol blank, not involving serialization and deserialization issues, with no extra stuff, and less overhead."}),"\n",(0,s.jsx)(n.li,{children:"gRPC, Thrift, Protobuf are based on DSL, require pre-preparation of corresponding protocols, and have a higher toolchain startup cost. Suitable for heavier logic scenarios."}),"\n"]})}),"\n",(0,s.jsx)(n.p,{children:"It is recommended to use ZMQ's PAIR-PAIR mode:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"The JS side acts as PAIR-SERVER, the X side as PAIR-CLIENT, with the X side actively connecting to the JS side."}),"\n",(0,s.jsx)(n.li,{children:"For debugging, the JS side opens an additional external port."}),"\n"]}),"\n",(0,s.jsx)(n.admonition,{title:"Why Recommend Using ZMQ's PAIR-PAIR Mode?",type:"info",children:(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"PAIR-PAIR only needs to use one port, which is the simplest full-duplex solution."}),"\n",(0,s.jsx)(n.li,{children:"Load balancing issues are not handled within a single container."}),"\n",(0,s.jsx)(n.li,{children:"Debugging issue: The X side cannot accept two connections, so entering the container cannot debug the X side's functionality, but an additional port can be listened to on the JS side for debugging purposes."}),"\n"]})}),"\n",(0,s.jsx)(n.h3,{id:"reactive-programming-paradigm-reactive-js-rxjs",children:"Reactive Programming Paradigm Reactive JS (RxJS)"}),"\n",(0,s.jsx)(n.p,{children:"To handle complex asynchronous logic, Yuan extensively uses Rx to build the system, and most interfaces are Rx Style. Rx itself is a cross-language programming approach, but it is limited by the syntax characteristics of each language, and its development status varies."}),"\n",(0,s.jsx)(n.p,{children:"We recommend using Rx on the JS side and not using Rx on the X side."}),"\n",(0,s.jsx)(n.admonition,{title:"Why Not Recommend Using Rx on the X Side?",type:"info",children:(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Languages with difficult anonymous function constructions may not have a good Rx implementation. For example, Python, C."}),"\n",(0,s.jsx)(n.li,{children:"It will add unnecessary complexity to the X side."}),"\n",(0,s.jsx)(n.li,{children:"From the perspective of comparative advantage, Rx should be used on the JS side to handle asynchronous scheduling."}),"\n"]})}),"\n",(0,s.jsx)(n.h2,{id:"some-miscellaneous-points",children:"Some Miscellaneous Points"}),"\n",(0,s.jsx)(n.p,{children:"Tips:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"The X side may not provide real-time subscription interfaces, requiring the JS side to actively poll."}),"\n",(0,s.jsx)(n.li,{children:"The X side may be missing some interfaces, but they can be synthesized indirectly through other interfaces, which may be quite complex."}),"\n",(0,s.jsx)(n.li,{children:"During development, it is often necessary to manually call the X side's functionality for debugging."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:"Recommendations:"}),"\n",(0,s.jsxs)(n.ol,{children:["\n",(0,s.jsx)(n.li,{children:"Use UUID in each message and print it in both sides' logs."}),"\n",(0,s.jsx)(n.li,{children:"It is recommended to use JSON for communication, if there is no JSON library in the X ecosystem, it can be downgraded to a CSV-like encoding format."}),"\n",(0,s.jsx)(n.li,{children:"Provide a Batch mechanism, as some provider APIs are low in performance (only occupying one synchronous thread) and must be batch processed."}),"\n",(0,s.jsx)(n.li,{children:"The X side's code design should \u5c3d\u91cf align with the X language's API naming semantics, handle as little as possible, and keep the logic thin, which helps in troubleshooting. If possible, generate template code corresponding to the SDK API used by the X side."}),"\n",(0,s.jsx)(n.li,{children:"Reuse and test the JS side's code to improve the efficiency and quality of provider integration."}),"\n",(0,s.jsx)(n.li,{children:"If possible, build corresponding libraries for commonly used X languages."}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}},4317:(e,n,i)=>{i.d(n,{Z:()=>a,a:()=>r});var s=i(3981);const t={},o=s.createContext(t);function r(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:r(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);